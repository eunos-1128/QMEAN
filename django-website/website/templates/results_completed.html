{% extends 'results_base.html' %}{% load static %}
{% block extra_title %}
<small><a href="{% url 'archive' projectid=projectid %}">All Model Results Archive <i class="glyphicon glyphicon-file"></i></a></small>
{% endblock %}
{% block results_block %}
<div class="row" style="margin-top:16px;">
<div class="col-sm-6">

{% for model in input_data.models %}

<div style="border: 1px solid #ddd; border-radius: 10px;padding:16px;">
	<table class="table table-condensed">
		<tr><th  width="160">Model Files:</th>
		<td><a href="{% url 'model_structure' projectid=projectid modelid=model.modelid %}">{{ model.name }} <i class="glyphicon glyphicon-file"></i></a>

		<a href="{% url 'archive' projectid=projectid modelid=model.modelid %}">Model Results Archive <i class="glyphicon glyphicon-file"></i></a>
		</td></tr>
		<tr><th>QMEAN Value:</th><td>{{ model.global_scores.qmean4.zscore|floatformat:"2" }}</td></tr>
		<tr><th>Zscores:</th>
			<td><img class="qmean" src="{% url 'qmean_pix' projectid=projectid modelid=model.modelid name='qmean4.png' %}"></td>
		<tr><th nowrap="nowrap">Absolute Quality:</th>
			<td><img class="qmean" src="{% url 'qmean_pix' projectid=projectid modelid=model.modelid name='local_quality_estimate.png' %}"></td>
		<tr><th>Residue Error:</th>
			<td><img class="qmean" src="{% url 'qmean_pix' projectid=projectid modelid=model.modelid name='reference_set.png' %}"></td></tr>
	</table>
</div>
{% endfor %}
</div>

<div class="col-sm-6">
	<div id="viewerWrapper" style="border: 1px solid #DDD; border-radius: 10px; padding:7px; margin-bottom:4px; height:300px;  width:100%">
	    <div id="pv" style="width:100%;height:100%;position:relative;">
	     	<div id="pv_status"></div>
	 	</div>
	</div>
	<div style="float:right" >
        <label style="margin-left:4px;padding: 5px 2px 5px 2px;" class="label label-primary">&nbsp;<a target="_blank" href="http://biasmv.github.io/pv/" style="color:#FFF">pv<i style="opacity:0.8; ont-size:.6em; margin-left:2px" class="glyphicon glyphicon-new-window"></i></a>&nbsp;</label>
   	</div>
</div>

<div class="clearfix">&nbsp;</div>
{% endblock %}
{% block js %}{{ block.super }}
<script type='text/javascript' src="{% static 'js/bio-pv.min.js' %}"></script>
<script>
var pv_viewer = pv.Viewer(document.getElementById('pv'), {
          width: 300,
          height: 300,
          antialias: true,
          quality : 'high'
        });

$(document).ready(
	function()
	{
		$('#viewerWrapper').height( $('#viewerWrapper').width() );
      	$('#pv').height( $('#viewerWrapper').width() );
      	$(window).resize(function() {
          $('#viewerWrapper').height( $('#viewerWrapper').width() );
          $('#pv').height( $('#viewerWrapper').width() );
          pv_viewer.fitParent();
        });
	
		$.get('{% url 'model_structure' projectid=projectid modelid=input_data.models.0.modelid %}',
	        function(data,s)
	        {
	            var pv_structure = pv.io.pdb(data);
	            var tube = pv_viewer.tube('{{ input_data.models.0.model.name }}', pv_structure.select('protein') );
	            tube.colorBy( pv.color.byAtomProp('tempFactor',
	                        pv.color.gradient(['blue','white','red'])
	                        ,[-0.2,1]
	                        ) );

	            pv_viewer.ballsAndSticks('{{ model.name }}.ligands',pv_structure.select({'chain':'_'}));
	            var dna = pv_structure.select('ligand').select({'rnames':['A','C','T','G','U','DA','DC','DG','DT']});
	            if(dna.residueCount()>0)
	              pv_viewer.lines('{{ modelname }}.dna',dna);

	            pv_viewer.fitParent();
	            pv_viewer.autoZoom();
	        });
	});



</script>
{% endblock %}